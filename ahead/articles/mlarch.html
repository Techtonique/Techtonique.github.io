<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beyond GARCH • ahead</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Beyond GARCH">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ahead</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.21.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ahead-loess-forecasting.html">Prediction intervals for Loess forecasting (simulation-based)</a>
    </li>
    <li>
      <a href="../articles/ahead-neutralize.html">Risk-neutralize simulations</a>
    </li>
    <li>
      <a href="../articles/ahead-plotting-functions.html">Plotting functions</a>
    </li>
    <li>
      <a href="../articles/ahead-ridge2-conformal.html">Conformal Prediction using Ridge2</a>
    </li>
    <li>
      <a href="../articles/ahead-ridge2-prediction-intervals.html">Prediction intervals for multivariate time series (simulation-based)</a>
    </li>
    <li>
      <a href="../articles/ahead-univariate-season.html">Univariate forecasting with `ridge2f` in `ahead`</a>
    </li>
    <li>
      <a href="../articles/ahead-vignette.html">Introduction to R package `ahead`</a>
    </li>
    <li>
      <a href="../articles/caretfitpredict.html">Fit and forecast using caret+dynrmf</a>
    </li>
    <li>
      <a href="../articles/comb_OLS.html">comb OLS Electricity</a>
    </li>
    <li>
      <a href="../articles/comb_OLS2.html">comb OLS AirPassengers</a>
    </li>
    <li>
      <a href="../articles/conformal-ml-stacking.html">Conformalized Forecasting using Machine Leaning models -- with stacked generalization</a>
    </li>
    <li>
      <a href="../articles/conformal-ml-stacking2.html">Conformalized Forecasting using Machine Leaning models -- with stacked generalization</a>
    </li>
    <li>
      <a href="../articles/conformal-ml.html">Conformalized Forecasting using Machine Leaning models</a>
    </li>
    <li>
      <a href="../articles/conformal-ml2.html">Conformalized Forecasting using Machine Leaning models 2</a>
    </li>
    <li>
      <a href="../articles/fitforecastbench.html">Fit and forecast for benchmarking purposes</a>
    </li>
    <li>
      <a href="../articles/generic-conformal.html">Generic forecasting and conformal prediction</a>
    </li>
    <li>
      <a href="../articles/glmthetaf-attention-conformal.html">Generalized Linear Model Theta Forecast with attention - conformal uncertainty</a>
    </li>
    <li>
      <a href="../articles/glmthetaf-attention.html">Generalized Linear Model Theta Forecast with attention</a>
    </li>
    <li>
      <a href="../articles/glmthetaf-ridge-attention.html">Ridge Theta Forecast with attention - conformal uncertainty</a>
    </li>
    <li>
      <a href="../articles/glmthetaf.html">Generalized Linear Model Theta Forecast</a>
    </li>
    <li>
      <a href="../articles/mlarch.html">Beyond GARCH</a>
    </li>
    <li>
      <a href="../articles/mlarch2.html">Beyond GARCH 2</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Beyond GARCH</h1>
            
      

      <div class="hidden name"><code>mlarch.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Probabilistic stock forecasting often relies on parametric models
like ARIMA for the mean and GARCH for volatility. The
<code>mlarchf</code> function in the <code>ahead</code> package offers a
flexible hybrid alternative to ARMA-GARCH by combining machine learning
approaches with ARCH effects.</p>
<p>The model decomposes the time series into two components:</p>
<ol style="list-style-type: decimal">
<li>Mean component:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>+</mo><msub><mi>σ</mi><mi>t</mi></msub><msub><mi>ε</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">y_t = \mu_t + \sigma_t \varepsilon_t</annotation></semantics></math>
</li>
<li>Volatility component:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>t</mi><mn>2</mn></msubsup><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>ε</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><mn>2</mn></msubsup><mo>,</mo><msubsup><mi>ε</mi><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow><mn>2</mn></msubsup><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\sigma_t^2 = f(\varepsilon_{t-1}^2, \varepsilon_{t-2}^2, ...)</annotation></semantics></math>
</li>
</ol>
<p>where:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\mu_t</annotation></semantics></math>
is the conditional mean (modeled using <strong>any forecasting
method</strong>)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\sigma_t</annotation></semantics></math>
is the conditional volatility (modeled using <strong>machine
learning</strong>)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ε</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\varepsilon_t</annotation></semantics></math>
are standardized residuals</li>
</ul>
<p>The <strong>key innovation</strong> is using machine learning methods
and conformal prediction to model the volatility component, allowing for
more flexible and potentially more accurate volatility forecasts than
traditional GARCH models. The function supports various machine learning
methods through parameters <code>fit_func</code> and
<code>predict_func</code> as in other <code>ahead</code> models, and
through the <code>caret</code> package.</p>
<p>The forecasting process involves:</p>
<ul>
<li>Fitting a mean model (default: <code>auto.arima</code>)</li>
<li>Modeling the squared residuals using machine learning. For this to
work, the residuals from the mean model need to be centered, so
that</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><msubsup><mi>ϵ</mi><mi>t</mi><mn>2</mn></msubsup><mo stretchy="false" form="prefix">|</mo><msub><mi>F</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\mathbb{E}[\epsilon_t^2|F_{t-1}]
</annotation></semantics></math></p>
<p>(basically a supervised regression of squared residuals on their
lags) is a good approximation of the latent conditional volatility</p>
<ul>
<li>Conformalizing the standardized residuals for prediction
intervals</li>
</ul>
<p>This new approach combines the interpretability of traditional time
series models with the flexibility of machine learning, while
maintaining proper uncertainty quantification through conformal
prediction.</p>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>Let’s start with a simple example using the Google stock price data
from the <code>fpp2</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">fpp2</span><span class="fu">::</span><span class="va"><a href="https://pkg.robjhyndman.com/fpp2-package/reference/goog.html" class="external-link">goog200</a></span></span>
<span></span>
<span><span class="co"># Default model for volatility (Ridge regression for volatility)</span></span>
<span><span class="op">(</span><span class="va">obj_ridge</span> <span class="op">&lt;-</span> <span class="fu">ahead</span><span class="fu">::</span><span class="fu"><a href="../reference/mlarchf.html">mlarchf</a></span><span class="op">(</span><span class="va">y</span>, h<span class="op">=</span><span class="fl">20L</span>, B<span class="op">=</span><span class="fl">500L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Point Forecast    Lo 95    Hi 95</span></span>
<span><span class="co">## 201       532.8683 510.6072 549.0701</span></span>
<span><span class="co">## 202       534.1620 510.1836 555.2200</span></span>
<span><span class="co">## 203       537.8519 455.6482 621.4205</span></span>
<span><span class="co">## 204       535.4597 523.3184 548.0685</span></span>
<span><span class="co">## 205       536.2701 515.9482 557.4350</span></span>
<span><span class="co">## 206       536.8562 516.9855 553.6221</span></span>
<span><span class="co">## 207       537.0966 522.2134 548.3146</span></span>
<span><span class="co">## 208       536.8214 509.8663 550.7663</span></span>
<span><span class="co">## 209       538.5965 519.8896 550.6361</span></span>
<span><span class="co">## 210       538.6741 514.6596 558.2802</span></span>
<span><span class="co">## 211       539.4124 510.6087 557.9464</span></span>
<span><span class="co">## 212       541.5197 524.6351 558.9229</span></span>
<span><span class="co">## 213       541.3757 514.1783 567.5858</span></span>
<span><span class="co">## 214       542.3874 520.2966 559.7851</span></span>
<span><span class="co">## 215       542.7441 515.4962 562.8581</span></span>
<span><span class="co">## 216       543.6913 518.4352 562.3159</span></span>
<span><span class="co">## 217       544.1679 531.4607 553.9185</span></span>
<span><span class="co">## 218       546.0748 513.9685 582.5379</span></span>
<span><span class="co">## 219       545.6681 511.9970 571.1057</span></span>
<span><span class="co">## 220       546.4334 524.3504 566.2234</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="different-machine-learning-methods">Different Machine Learning Methods<a class="anchor" aria-label="anchor" href="#different-machine-learning-methods"></a>
</h2>
<p>The package supports various machine learning methods for volatility
modeling. Here are some examples:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Random Forest</span></span>
<span><span class="op">(</span><span class="va">obj_rf</span> <span class="op">&lt;-</span> <span class="fu">ahead</span><span class="fu">::</span><span class="fu"><a href="../reference/mlarchf.html">mlarchf</a></span><span class="op">(</span><span class="va">y</span>, fit_func <span class="op">=</span> <span class="fu">randomForest</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span>, </span>
<span>                     predict_func <span class="op">=</span> <span class="va">predict</span>, h<span class="op">=</span><span class="fl">20L</span>, B<span class="op">=</span><span class="fl">500L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Point Forecast    Lo 95    Hi 95</span></span>
<span><span class="co">## 201       532.9943 514.9818 546.3583</span></span>
<span><span class="co">## 202       535.6430 473.9838 583.8987</span></span>
<span><span class="co">## 203       536.6626 516.8293 586.4722</span></span>
<span><span class="co">## 204       537.2098 512.6205 563.7898</span></span>
<span><span class="co">## 205       535.3415 528.9124 541.6989</span></span>
<span><span class="co">## 206       538.4757 504.1888 565.2346</span></span>
<span><span class="co">## 207       536.5940 529.0149 541.9653</span></span>
<span><span class="co">## 208       536.8695 456.9157 560.6926</span></span>
<span><span class="co">## 209       538.3905 528.9728 544.5427</span></span>
<span><span class="co">## 210       539.0829 488.7497 569.5273</span></span>
<span><span class="co">## 211       539.1325 530.3422 544.4237</span></span>
<span><span class="co">## 212       542.0685 521.4105 561.6385</span></span>
<span><span class="co">## 213       541.0877 533.4657 548.2760</span></span>
<span><span class="co">## 214       542.6126 507.4853 571.4893</span></span>
<span><span class="co">## 215       542.0972 533.1655 547.1384</span></span>
<span><span class="co">## 216       545.2356 495.8112 578.3687</span></span>
<span><span class="co">## 217       543.8493 538.2177 547.9920</span></span>
<span><span class="co">## 218       551.4629 485.5071 721.1598</span></span>
<span><span class="co">## 219       544.8177 535.2052 554.2283</span></span>
<span><span class="co">## 220       547.5296 508.4202 575.9079</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Support Vector Machine</span></span>
<span><span class="op">(</span><span class="va">obj_svm</span> <span class="op">&lt;-</span> <span class="fu">ahead</span><span class="fu">::</span><span class="fu"><a href="../reference/mlarchf.html">mlarchf</a></span><span class="op">(</span><span class="va">y</span>, fit_func <span class="op">=</span> <span class="fu">e1071</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/e1071/man/svm.html" class="external-link">svm</a></span>, </span>
<span>                     predict_func <span class="op">=</span> <span class="va">predict</span>, h<span class="op">=</span><span class="fl">20L</span>, B<span class="op">=</span><span class="fl">500L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Point Forecast    Lo 95    Hi 95</span></span>
<span><span class="co">## 201       532.4934 522.4649 539.7515</span></span>
<span><span class="co">## 202       533.7948 517.0382 548.4818</span></span>
<span><span class="co">## 203       535.8943 491.5423 582.5843</span></span>
<span><span class="co">## 204       535.3236 524.5294 546.6604</span></span>
<span><span class="co">## 205       535.8114 522.6526 549.5445</span></span>
<span><span class="co">## 206       536.6484 520.1038 550.2097</span></span>
<span><span class="co">## 207       536.8970 526.1589 544.8919</span></span>
<span><span class="co">## 208       536.8676 515.4748 547.6928</span></span>
<span><span class="co">## 209       538.3806 524.2927 547.3659</span></span>
<span><span class="co">## 210       539.1035 517.5743 557.9289</span></span>
<span><span class="co">## 211       539.5177 515.8533 554.2971</span></span>
<span><span class="co">## 212       541.1323 528.2824 555.1481</span></span>
<span><span class="co">## 213       541.1741 519.9923 560.9940</span></span>
<span><span class="co">## 214       542.0895 524.9697 555.6496</span></span>
<span><span class="co">## 215       542.6036 521.4297 559.3157</span></span>
<span><span class="co">## 216       543.4293 523.8594 557.6665</span></span>
<span><span class="co">## 217       543.9761 534.1496 551.4794</span></span>
<span><span class="co">## 218       545.5987 520.7796 573.8206</span></span>
<span><span class="co">## 219       545.4529 519.2999 565.1699</span></span>
<span><span class="co">## 220       546.2045 528.9343 561.0275</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Elastic Net</span></span>
<span><span class="op">(</span><span class="va">obj_glmnet</span> <span class="op">&lt;-</span> <span class="fu">ahead</span><span class="fu">::</span><span class="fu"><a href="../reference/mlarchf.html">mlarchf</a></span><span class="op">(</span><span class="va">y</span>, fit_func <span class="op">=</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="va"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span>, </span>
<span>                     predict_func <span class="op">=</span> <span class="va">predict</span>, h<span class="op">=</span><span class="fl">20L</span>, B<span class="op">=</span><span class="fl">500L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Point Forecast    Lo 95    Hi 95</span></span>
<span><span class="co">## 201       533.0081 506.2610 552.4747</span></span>
<span><span class="co">## 202       534.0312 512.4848 552.9534</span></span>
<span><span class="co">## 203       537.9979 452.9923 624.4150</span></span>
<span><span class="co">## 204       535.4434 523.4675 547.8804</span></span>
<span><span class="co">## 205       536.2787 515.8231 557.5828</span></span>
<span><span class="co">## 206       536.8552 517.0005 553.6076</span></span>
<span><span class="co">## 207       537.0983 522.1824 548.3408</span></span>
<span><span class="co">## 208       536.8211 509.8375 550.7809</span></span>
<span><span class="co">## 209       538.5978 519.8626 550.6556</span></span>
<span><span class="co">## 210       538.6744 514.6277 558.3068</span></span>
<span><span class="co">## 211       539.4128 510.5685 557.9729</span></span>
<span><span class="co">## 212       541.5220 524.6141 558.9493</span></span>
<span><span class="co">## 213       541.3769 514.1416 567.6234</span></span>
<span><span class="co">## 214       542.3890 520.2676 559.8108</span></span>
<span><span class="co">## 215       542.7453 515.4595 562.8872</span></span>
<span><span class="co">## 216       543.6928 518.4017 562.3432</span></span>
<span><span class="co">## 217       544.1691 531.4442 553.9332</span></span>
<span><span class="co">## 218       546.0777 513.9268 582.5913</span></span>
<span><span class="co">## 219       545.6694 511.9516 571.1424</span></span>
<span><span class="co">## 220       546.4348 524.3211 566.2522</span></span></code></pre>
<p>Let’s visualize the forecasts:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj_ridge</span>, main<span class="op">=</span><span class="st">"Ridge Regression"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj_rf</span>, main<span class="op">=</span><span class="st">"Random Forest"</span><span class="op">)</span></span></code></pre></div>
<p><img src="mlarch_files/figure-html/plot_ridge_rf-1.png" width="691.2"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj_svm</span>, main<span class="op">=</span><span class="st">"Support Vector Machine"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj_glmnet</span>, main<span class="op">=</span><span class="st">"Elastic Net"</span><span class="op">)</span></span></code></pre></div>
<p><img src="mlarch_files/figure-html/plot_svm_glmnet-1.png" width="691.2"></p>
</div>
<div class="section level2">
<h2 id="using-caret-models">Using caret Models<a class="anchor" aria-label="anchor" href="#using-caret-models"></a>
</h2>
<p>The package also supports models from the <code>caret</code> package,
which provides access to hundreds of machine learning methods. Here’s
how to use them:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="fu">fpp2</span><span class="fu">::</span><span class="va"><a href="https://pkg.robjhyndman.com/fpp2-package/reference/goog.html" class="external-link">goog200</a></span>, start<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Random Forest via caret</span></span>
<span><span class="op">(</span><span class="va">obj_rf</span> <span class="op">&lt;-</span> <span class="fu">ahead</span><span class="fu">::</span><span class="fu"><a href="../reference/mlarchf.html">mlarchf</a></span><span class="op">(</span><span class="va">y</span>, ml_method<span class="op">=</span><span class="st">"ranger"</span>, h<span class="op">=</span><span class="fl">20L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Point Forecast    Lo 95    Hi 95</span></span>
<span><span class="co">## 201       534.0896 527.2105 549.2119</span></span>
<span><span class="co">## 202       540.8033 506.2501 676.2634</span></span>
<span><span class="co">## 203       535.4651 525.0756 554.5970</span></span>
<span><span class="co">## 204       536.0222 512.5343 561.4383</span></span>
<span><span class="co">## 205       534.7667 513.1644 552.6010</span></span>
<span><span class="co">## 206       536.8632 523.8917 577.7776</span></span>
<span><span class="co">## 207       534.4352 523.6236 550.2029</span></span>
<span><span class="co">## 208       540.1830 514.0565 591.3863</span></span>
<span><span class="co">## 209       534.2758 525.7503 549.4391</span></span>
<span><span class="co">## 210       539.9345 506.9003 611.3457</span></span>
<span><span class="co">## 211       536.3750 518.6688 553.7465</span></span>
<span><span class="co">## 212       538.4359 525.6782 618.8693</span></span>
<span><span class="co">## 213       535.9024 517.3023 564.3173</span></span>
<span><span class="co">## 214       538.7200 502.9221 580.7261</span></span>
<span><span class="co">## 215       535.2246 524.7153 566.6379</span></span>
<span><span class="co">## 216       536.5341 526.6102 586.9456</span></span>
<span><span class="co">## 217       541.5191 520.9008 576.9608</span></span>
<span><span class="co">## 218       541.0114 506.6884 575.3034</span></span>
<span><span class="co">## 219       535.0434 527.2991 549.4959</span></span>
<span><span class="co">## 220       544.4411 516.0606 639.3218</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Gradient Boosting via caret</span></span>
<span><span class="op">(</span><span class="va">obj_glmboost</span> <span class="op">&lt;-</span> <span class="fu">ahead</span><span class="fu">::</span><span class="fu"><a href="../reference/mlarchf.html">mlarchf</a></span><span class="op">(</span><span class="va">y</span>, ml_method<span class="op">=</span><span class="st">"glmboost"</span>, h<span class="op">=</span><span class="fl">20L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Point Forecast    Lo 95    Hi 95</span></span>
<span><span class="co">## 201       536.7254 524.0021 561.1012</span></span>
<span><span class="co">## 202       537.2241 516.4879 576.7179</span></span>
<span><span class="co">## 203       536.0656 523.2692 561.0059</span></span>
<span><span class="co">## 204       536.3933 516.0502 562.9614</span></span>
<span><span class="co">## 205       535.4724 513.0202 553.4245</span></span>
<span><span class="co">## 206       539.5897 520.5008 594.8892</span></span>
<span><span class="co">## 207       538.9055 509.9366 581.2882</span></span>
<span><span class="co">## 208       541.8347 516.0594 595.3970</span></span>
<span><span class="co">## 209       536.6201 523.1016 561.5969</span></span>
<span><span class="co">## 210       546.8758 502.1903 678.2426</span></span>
<span><span class="co">## 211       540.0372 509.7394 586.5420</span></span>
<span><span class="co">## 212       537.0641 524.2422 568.2773</span></span>
<span><span class="co">## 213       537.6658 517.8344 564.1649</span></span>
<span><span class="co">## 214       537.6244 516.2911 565.5337</span></span>
<span><span class="co">## 215       538.7529 521.8397 602.8892</span></span>
<span><span class="co">## 216       541.5688 523.7738 668.0133</span></span>
<span><span class="co">## 217       541.0185 523.9721 603.8553</span></span>
<span><span class="co">## 218       542.2963 517.5191 584.6708</span></span>
<span><span class="co">## 219       537.7170 524.9537 562.6072</span></span>
<span><span class="co">## 220       557.4956 515.8869 751.6655</span></span></code></pre>
<p>Visualizing the forecasts:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj_rf</span>, main<span class="op">=</span><span class="st">"Random Forest (caret)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj_glmboost</span>, main<span class="op">=</span><span class="st">"Gradient Boosting (caret)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="mlarch_files/figure-html/plot_caret-1.png" width="691.2"></p>
<p>Looking at the simulation paths:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">obj_rf</span><span class="op">$</span><span class="va">sims</span>, type<span class="op">=</span><span class="st">'l'</span>, main<span class="op">=</span><span class="st">"RF Simulation Paths"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">obj_glmboost</span><span class="op">$</span><span class="va">sims</span>, type<span class="op">=</span><span class="st">'l'</span>, main<span class="op">=</span><span class="st">"GBM Simulation Paths"</span><span class="op">)</span></span></code></pre></div>
<p><img src="mlarch_files/figure-html/plot_sims-1.png" width="691.2"></p>
</div>
<div class="section level2">
<h2 id="customizing-mean-and-residual-models">Customizing Mean and Residual Models<a class="anchor" aria-label="anchor" href="#customizing-mean-and-residual-models"></a>
</h2>
<p>You can also customize both the mean forecasting model and the model
for forecasting standardized residuals:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using RW + Theta method for mean and residuals along with SVM for volatility</span></span>
<span><span class="op">(</span><span class="va">obj_svm</span> <span class="op">&lt;-</span> <span class="fu">ahead</span><span class="fu">::</span><span class="fu"><a href="../reference/mlarchf.html">mlarchf</a></span><span class="op">(</span><span class="va">y</span>, fit_func <span class="op">=</span> <span class="fu">e1071</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/e1071/man/svm.html" class="external-link">svm</a></span>, </span>
<span>                     predict_func <span class="op">=</span> <span class="va">predict</span>, h<span class="op">=</span><span class="fl">20L</span>, </span>
<span>                     mean_model<span class="op">=</span><span class="fu">forecast</span><span class="fu">::</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/reference/naive.html" class="external-link">rwf</a></span>,</span>
<span>                     model_residuals<span class="op">=</span><span class="fu">forecast</span><span class="fu">::</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/reference/thetaf.html" class="external-link">thetaf</a></span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Point Forecast    Lo 95    Hi 95</span></span>
<span><span class="co">## 201       536.7001 524.0427 560.8327</span></span>
<span><span class="co">## 202       538.0314 514.4173 583.0770</span></span>
<span><span class="co">## 203       535.8869 523.5741 559.8654</span></span>
<span><span class="co">## 204       537.4383 512.7645 569.5894</span></span>
<span><span class="co">## 205       535.4157 513.2780 553.1443</span></span>
<span><span class="co">## 206       540.9776 518.5788 605.5379</span></span>
<span><span class="co">## 207       539.0655 509.5605 582.2023</span></span>
<span><span class="co">## 208       543.2671 513.9431 604.0251</span></span>
<span><span class="co">## 209       536.8391 522.7220 562.9176</span></span>
<span><span class="co">## 210       548.6580 498.8522 695.3473</span></span>
<span><span class="co">## 211       540.5741 508.3049 590.1480</span></span>
<span><span class="co">## 212       537.6249 523.5462 571.9791</span></span>
<span><span class="co">## 213       538.0943 516.8791 566.4469</span></span>
<span><span class="co">## 214       538.1972 514.8895 568.6467</span></span>
<span><span class="co">## 215       539.2980 521.1176 608.3200</span></span>
<span><span class="co">## 216       542.4556 523.0970 680.1538</span></span>
<span><span class="co">## 217       541.8127 523.3560 609.9607</span></span>
<span><span class="co">## 218       543.2392 516.3275 589.2513</span></span>
<span><span class="co">## 219       538.2161 524.4095 565.0870</span></span>
<span><span class="co">## 220       559.7157 514.5775 769.9032</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using Theta + Theta method for mean and residuals along with GLMNET for volatility</span></span>
<span><span class="op">(</span><span class="va">obj_glmnet</span> <span class="op">&lt;-</span> <span class="fu">ahead</span><span class="fu">::</span><span class="fu"><a href="../reference/mlarchf.html">mlarchf</a></span><span class="op">(</span><span class="va">y</span>, fit_func <span class="op">=</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="va"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span>, </span>
<span>                     predict_func <span class="op">=</span> <span class="va">predict</span>, h<span class="op">=</span><span class="fl">20L</span>, </span>
<span>                     mean_model<span class="op">=</span><span class="fu">forecast</span><span class="fu">::</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/reference/thetaf.html" class="external-link">thetaf</a></span>,</span>
<span>                     model_residuals<span class="op">=</span><span class="fu">forecast</span><span class="fu">::</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/reference/thetaf.html" class="external-link">thetaf</a></span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Point Forecast    Lo 95    Hi 95</span></span>
<span><span class="co">## 201       539.7210 521.7443 571.0620</span></span>
<span><span class="co">## 202       536.1702 523.4416 562.4592</span></span>
<span><span class="co">## 203       537.3178 525.2986 563.1430</span></span>
<span><span class="co">## 204       537.1867 520.3207 560.1881</span></span>
<span><span class="co">## 205       537.4467 516.6405 554.9163</span></span>
<span><span class="co">## 206       540.9844 525.3315 584.7582</span></span>
<span><span class="co">## 207       541.9160 515.3199 579.7897</span></span>
<span><span class="co">## 208       544.2088 523.5243 589.6411</span></span>
<span><span class="co">## 209       540.4673 529.1910 562.9970</span></span>
<span><span class="co">## 210       550.2739 510.0462 671.8512</span></span>
<span><span class="co">## 211       544.6859 517.0620 588.9166</span></span>
<span><span class="co">## 212       542.2312 530.6821 571.1815</span></span>
<span><span class="co">## 213       543.1535 527.9466 566.9051</span></span>
<span><span class="co">## 214       543.4203 526.1855 568.1847</span></span>
<span><span class="co">## 215       544.9848 530.6582 585.6213</span></span>
<span><span class="co">## 216       547.9162 533.7306 662.0766</span></span>
<span><span class="co">## 217       548.6211 532.6393 608.8480</span></span>
<span><span class="co">## 218       549.8988 532.7408 588.1457</span></span>
<span><span class="co">## 219       546.3406 535.2334 568.0789</span></span>
<span><span class="co">## 220       564.5126 529.8817 740.9622</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj_svm</span>, main<span class="op">=</span><span class="st">"SVM with RW + Theta"</span><span class="op">)</span></span></code></pre></div>
<p><img src="mlarch_files/figure-html/plot_custom-1.png" width="691.2"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj_glmnet</span>, main<span class="op">=</span><span class="st">"Elastic Net with Theta + Theta"</span><span class="op">)</span></span></code></pre></div>
<p><img src="mlarch_files/figure-html/plot_custom-2.png" width="691.2"></p>
<p>When using non-ARIMA models for the mean forecast, it’s important to
check if the residuals of the mean forecasting model are centered and
stationary:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Diagnostic tests for residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">obj_svm</span><span class="op">$</span><span class="va">resids_t_test</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  One Sample t-test</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  resids</span></span>
<span><span class="co">## t = 1.0148, df = 99, p-value = 0.3127</span></span>
<span><span class="co">## alternative hypothesis: true mean is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  -0.7180739  2.2214961</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## mean of x </span></span>
<span><span class="co">## 0.7517111</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">obj_svm</span><span class="op">$</span><span class="va">resids_kpss_test</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  KPSS Test for Level Stationarity</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  resids</span></span>
<span><span class="co">## KPSS Level = -6.5559e-153, Truncation lag parameter = 4, p-value = 0.1</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">obj_glmnet</span><span class="op">$</span><span class="va">resids_t_test</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  One Sample t-test</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  resids</span></span>
<span><span class="co">## t = 1.0992, df = 100, p-value = 0.2743</span></span>
<span><span class="co">## alternative hypothesis: true mean is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  -0.6460748  2.2513707</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## mean of x </span></span>
<span><span class="co">## 0.8026479</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">obj_glmnet</span><span class="op">$</span><span class="va">resids_kpss_test</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  KPSS Test for Level Stationarity</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  resids</span></span>
<span><span class="co">## KPSS Level = 0.26089, Truncation lag parameter = 4, p-value = 0.1</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by T. Moudiki.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
