<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ridge model â€¢ rvfl</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Ridge model">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rvfl</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/rvfl.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bootstrap.html">Ridge model (bootstrap) model</a>
    </li>
    <li>
      <a href="../articles/GLM.html">Ridge GLM model</a>
    </li>
    <li>
      <a href="../articles/GLMGamma.html">Ridge GLM Gamma model</a>
    </li>
    <li>
      <a href="../articles/nnet.html">Ridge NNET model</a>
    </li>
    <li>
      <a href="../articles/ridgemodel_summary_plot.html">Ridge model</a>
    </li>
    <li>
      <a href="../articles/ridgemodel.html">Ridge model</a>
    </li>
    <li>
      <a href="../articles/rvfl_summary_plot.html">Ridge model</a>
    </li>
    <li>
      <a href="../articles/surrogate.html">Ridge model (surrogate) model</a>
    </li>
    <li>
      <a href="../articles/svm.html">SVM model</a>
    </li>
    <li>
      <a href="../articles/zeroinfl.html">Zero-inflated GLM model (plus other models)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Ridge model</h1>
            
      

      <div class="hidden name"><code>ridgemodel.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rvfl</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="example-1-mpg-prediction-mtcars-dataset">Example 1: MPG Prediction (mtcars dataset)<a class="anchor" aria-label="anchor" href="#example-1-mpg-prediction-mtcars-dataset"></a>
</h2>
<div class="section level3">
<h3 id="load-and-prepare-data">Load and prepare data<a class="anchor" aria-label="anchor" href="#load-and-prepare-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1243</span><span class="op">)</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">0.8</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">mtcars</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-models">Fit models<a class="anchor" aria-label="anchor" href="#fit-models"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit regular linear model</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">lm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">##   0.012</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = mpg ~ ., data = train_data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -3.5211 -0.9792 -0.0324  1.1808  4.9814 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)  </span></span>
<span><span class="co">## (Intercept) -5.054416  25.456900  -0.199   0.8455  </span></span>
<span><span class="co">## cyl          0.695392   1.396506   0.498   0.6262  </span></span>
<span><span class="co">## disp         0.005254   0.017342   0.303   0.7664  </span></span>
<span><span class="co">## hp          -0.007610   0.027723  -0.274   0.7877  </span></span>
<span><span class="co">## drat         4.128157   2.724353   1.515   0.1520  </span></span>
<span><span class="co">## wt          -1.621396   2.139071  -0.758   0.4610  </span></span>
<span><span class="co">## qsec         0.064356   0.932144   0.069   0.9459  </span></span>
<span><span class="co">## vs           0.138716   3.421183   0.041   0.9682  </span></span>
<span><span class="co">## am          -0.498476   2.956568  -0.169   0.8685  </span></span>
<span><span class="co">## gear         4.402648   2.287816   1.924   0.0749 .</span></span>
<span><span class="co">## carb        -1.999389   1.299580  -1.538   0.1462  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 2.464 on 14 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.8938, Adjusted R-squared:  0.818 </span></span>
<span><span class="co">## F-statistic: 11.79 on 10 and 14 DF,  p-value: 3.4e-05</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                    2.5 %      97.5 %</span></span>
<span><span class="co">## (Intercept) -59.65403559 49.54520296</span></span>
<span><span class="co">## cyl          -2.29981561  3.69060001</span></span>
<span><span class="co">## disp         -0.03194096  0.04244882</span></span>
<span><span class="co">## hp           -0.06707095  0.05185084</span></span>
<span><span class="co">## drat         -1.71500030  9.97131342</span></span>
<span><span class="co">## wt           -6.20924769  2.96645550</span></span>
<span><span class="co">## qsec         -1.93489537  2.06360651</span></span>
<span><span class="co">## vs           -7.19899241  7.47642359</span></span>
<span><span class="co">## am           -6.83968216  5.84273112</span></span>
<span><span class="co">## gear         -0.50422869  9.30952400</span></span>
<span><span class="co">## carb         -4.78671119  0.78793282</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit calibrated model </span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">ridge_model</span> <span class="op">&lt;-</span> <span class="fu">rvfl</span><span class="fu">::</span><span class="fu">calibmodel</span><span class="op">(</span>lambda<span class="op">=</span><span class="fl">10</span><span class="op">**</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">train_data</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">##   0.027</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ridge_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $model_summary</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## engine(formula = y ~ . - 1, data = df_train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -3.5715 -1.6454 -0.6596  1.9582  5.6548 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##      Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">## cyl   -0.4956     0.7586  -0.653    0.524</span></span>
<span><span class="co">## disp  -0.5709     0.7473  -0.764    0.458</span></span>
<span><span class="co">## hp    -0.6475     0.7508  -0.862    0.403</span></span>
<span><span class="co">## drat   0.8272     0.6951   1.190    0.254</span></span>
<span><span class="co">## wt    -0.7784     0.7239  -1.075    0.300</span></span>
<span><span class="co">## qsec   0.2927     0.7384   0.396    0.698</span></span>
<span><span class="co">## vs     0.4345     0.7133   0.609    0.552</span></span>
<span><span class="co">## am     0.7154     0.6849   1.045    0.314</span></span>
<span><span class="co">## gear   0.4152     0.7179   0.578    0.572</span></span>
<span><span class="co">## carb  -0.7023     0.6358  -1.105    0.288</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 2.99 on 14 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.7422, Adjusted R-squared:  0.5581 </span></span>
<span><span class="co">## F-statistic: 4.031 on 10 and 14 DF,  p-value: 0.009055</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $derivatives_summary</span></span>
<span><span class="co">##      Effect.mean of x    Std.Error       p.value     CI.lower     CI.upper</span></span>
<span><span class="co">## cyl      -0.272562363 1.251420e-11 1.261186e-223 -0.272562363 -0.272562363</span></span>
<span><span class="co">## disp     -0.004417317 1.602004e-11 5.557056e-180 -0.004417317 -0.004417317</span></span>
<span><span class="co">## hp       -0.011728958 1.766407e-11 9.254360e-189 -0.011728958 -0.011728958</span></span>
<span><span class="co">## drat      1.594838830 1.851980e-11 2.340861e-237  1.594838830  1.594838830</span></span>
<span><span class="co">## wt       -0.748782818 1.224970e-11 6.207613e-234 -0.748782819 -0.748782818</span></span>
<span><span class="co">## qsec      0.188050094 3.700743e-12 4.350927e-232  0.188050094  0.188050094</span></span>
<span><span class="co">## vs        0.857626338 1.185444e-11 1.287167e-235  0.857626338  0.857626338</span></span>
<span><span class="co">## am        1.460396700 6.124848e-12 1.572499e-247  1.460396700  1.460396700</span></span>
<span><span class="co">## gear      0.638082724 1.510165e-11 3.031228e-230  0.638082724  0.638082724</span></span>
<span><span class="co">## carb     -0.532426743 1.504239e-11 1.780484e-228 -0.532426743 -0.532426743</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="make-predictions">Make predictions<a class="anchor" aria-label="anchor" href="#make-predictions"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">lm_model</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span>
<span><span class="va">ridge_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ridge_model</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-predictions">Compare predictions<a class="anchor" aria-label="anchor" href="#compare-predictions"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Actual <span class="op">=</span> <span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">mpg</span>,</span>
<span>  LM_Pred <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,</span>
<span>  LM_Lower <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>,</span>
<span>  LM_Upper <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span>,</span>
<span>  Ridge_Pred <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,</span>
<span>  Ridge_Lower <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>, </span>
<span>  Ridge_Upper <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Prediction Intervals Comparison:"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Prediction Intervals Comparison:"</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                Actual  LM_Pred  LM_Lower LM_Upper Ridge_Pred Ridge_Lower</span></span>
<span><span class="co">## Valiant          18.1 17.93324 10.149847 25.71663   19.88520    16.55519</span></span>
<span><span class="co">## Merc 280C        17.8 20.63530 13.636618 27.63398   20.95955    16.97131</span></span>
<span><span class="co">## Toyota Corolla   33.9 28.58373 22.379666 34.78779   27.44891    23.92696</span></span>
<span><span class="co">## Camaro Z28       13.3 15.85710  8.140858 23.57335   15.19122    11.43924</span></span>
<span><span class="co">## Porsche 914-2    26.0 31.07535 18.988702 43.16201   25.48120    22.20837</span></span>
<span><span class="co">## Ford Pantera L   15.8 27.07516 14.930150 39.22016   19.34804    15.02970</span></span>
<span><span class="co">##                Ridge_Upper</span></span>
<span><span class="co">## Valiant           23.95417</span></span>
<span><span class="co">## Merc 280C         24.56564</span></span>
<span><span class="co">## Toyota Corolla    31.76149</span></span>
<span><span class="co">## Camaro Z28        18.52793</span></span>
<span><span class="co">## Porsche 914-2     29.47377</span></span>
<span><span class="co">## Ford Pantera L    22.42565</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate coverage and Winkler scores</span></span>
<span><span class="va">lm_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">mpg</span> <span class="op">&gt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span> <span class="op">&amp;</span> </span>
<span>                   <span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">mpg</span> <span class="op">&lt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">)</span></span>
<span><span class="va">ridge_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">mpg</span> <span class="op">&gt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span> <span class="op">&amp;</span> </span>
<span>                      <span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">mpg</span> <span class="op">&lt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_winkler</span> <span class="op">&lt;-</span> <span class="fu">misc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/misc/man/winkler_score.html" class="external-link">winkler_score</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">mpg</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">)</span></span>
<span><span class="va">ridge_winkler</span> <span class="op">&lt;-</span> <span class="fu">misc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/misc/man/winkler_score.html" class="external-link">winkler_score</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">mpg</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nPrediction interval metrics:"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "\nPrediction interval metrics:"</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Linear Model: %.1f%% coverage, %.3f Winkler score"</span>, </span>
<span>              <span class="fl">100</span> <span class="op">*</span> <span class="va">lm_coverage</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lm_winkler</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Linear Model: 100.0% coverage, 18.226 Winkler score"</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Calibrated Model: %.1f%% coverage, %.3f Winkler score"</span>, </span>
<span>              <span class="fl">100</span> <span class="op">*</span> <span class="va">ridge_coverage</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ridge_winkler</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Calibrated Model: 85.7% coverage, 19.732 Winkler score"</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set common y-axis limits for both plots</span></span>
<span><span class="va">y_limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span>,</span>
<span>                   <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot prediction intervals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Linear Model Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Pred</span>, </span>
<span>     main<span class="op">=</span><span class="st">"Linear Model Predictions"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Actual MPG"</span>, ylab<span class="op">=</span><span class="st">"Predicted MPG"</span>,</span>
<span>     ylim<span class="op">=</span><span class="va">y_limits</span><span class="op">)</span></span>
<span><span class="co"># Add shaded prediction intervals</span></span>
<span><span class="va">x_ordered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Pred</span><span class="op">)</span>  <span class="co"># Replot points over shading</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>  <span class="co"># Add diagonal line</span></span>
<span></span>
<span><span class="co"># Ridge Model Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Pred</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Ridge Model Predictions"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Actual MPG"</span>, ylab<span class="op">=</span><span class="st">"Predicted MPG"</span>,</span>
<span>     ylim<span class="op">=</span><span class="va">y_limits</span><span class="op">)</span></span>
<span><span class="co"># Add shaded prediction intervals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Pred</span><span class="op">)</span>  <span class="co"># Replot points over shading</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>  <span class="co"># Add diagonal line</span></span></code></pre></div>
<p><img src="ridgemodel_files/figure-html/unnamed-chunk-5-1.png" width="720"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add simulation plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Generate 100 simulations</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">ridge_model</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>, nsim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="co"># Plot simulations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">sims</span>, type <span class="op">=</span> <span class="st">"l"</span>, </span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"obs. #"</span>, ylab <span class="op">=</span> <span class="st">"Simulated MPG"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Ridge Model Simulations"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">mpg</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>        </span></code></pre></div>
<p><img src="ridgemodel_files/figure-html/unnamed-chunk-6-1.png" width="720"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-2-boston-housing-price-prediction">Example 2: Boston Housing Price Prediction<a class="anchor" aria-label="anchor" href="#example-2-boston-housing-price-prediction"></a>
</h2>
<div class="section level3">
<h3 id="load-and-prepare-data-1">Load and prepare data<a class="anchor" aria-label="anchor" href="#load-and-prepare-data-1"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1243</span><span class="op">)</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">0.8</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">Boston</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">Boston</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">-</span><span class="fl">14</span><span class="op">]</span>  <span class="co"># -14 removes 'medv' (target variable)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-models-1">Fit models<a class="anchor" aria-label="anchor" href="#fit-models-1"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit regular linear model</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">lm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">##   0.009</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = medv ~ ., data = train_data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -15.220  -2.757  -0.494   1.863  26.961 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)  35.832339   5.763210   6.217 1.30e-09 ***</span></span>
<span><span class="co">## crim         -0.095389   0.034717  -2.748 0.006282 ** </span></span>
<span><span class="co">## zn            0.042689   0.016086   2.654 0.008283 ** </span></span>
<span><span class="co">## indus        -0.033013   0.073521  -0.449 0.653657    </span></span>
<span><span class="co">## chas          2.506064   0.939731   2.667 0.007977 ** </span></span>
<span><span class="co">## nox         -17.521010   4.237379  -4.135 4.35e-05 ***</span></span>
<span><span class="co">## rm            3.966727   0.477640   8.305 1.66e-15 ***</span></span>
<span><span class="co">## age           0.006479   0.014922   0.434 0.664410    </span></span>
<span><span class="co">## dis          -1.463187   0.232348  -6.297 8.17e-10 ***</span></span>
<span><span class="co">## rad           0.253984   0.075379   3.369 0.000828 ***</span></span>
<span><span class="co">## tax          -0.009853   0.004350  -2.265 0.024068 *  </span></span>
<span><span class="co">## ptratio      -1.002914   0.147016  -6.822 3.44e-11 ***</span></span>
<span><span class="co">## black         0.008723   0.002984   2.923 0.003664 ** </span></span>
<span><span class="co">## lstat        -0.501984   0.057704  -8.699  &lt; 2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 4.835 on 390 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.7403, Adjusted R-squared:  0.7316 </span></span>
<span><span class="co">## F-statistic: 85.51 on 13 and 390 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                    2.5 %      97.5 %</span></span>
<span><span class="co">## (Intercept)  24.50149090 47.16318623</span></span>
<span><span class="co">## crim         -0.16364441 -0.02713269</span></span>
<span><span class="co">## zn            0.01106383  0.07431451</span></span>
<span><span class="co">## indus        -0.17755967  0.11153316</span></span>
<span><span class="co">## chas          0.65849254  4.35363615</span></span>
<span><span class="co">## nox         -25.85197459 -9.19004505</span></span>
<span><span class="co">## rm            3.02765548  4.90579898</span></span>
<span><span class="co">## age          -0.02285933  0.03581667</span></span>
<span><span class="co">## dis          -1.91999833 -1.00637601</span></span>
<span><span class="co">## rad           0.10578379  0.40218383</span></span>
<span><span class="co">## tax          -0.01840515 -0.00129986</span></span>
<span><span class="co">## ptratio      -1.29195676 -0.71387117</span></span>
<span><span class="co">## black         0.00285660  0.01458927</span></span>
<span><span class="co">## lstat        -0.61543411 -0.38853422</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit calibrated model </span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">ridge_model</span> <span class="op">&lt;-</span> <span class="fu">rvfl</span><span class="fu">::</span><span class="fu">calibmodel</span><span class="op">(</span>lambda<span class="op">=</span><span class="fl">10</span><span class="op">**</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">14</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">train_data</span><span class="op">$</span><span class="va">medv</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">##   0.059</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ridge_model</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## engine(formula = y ~ . - 1, data = df_train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -10.8939  -2.9240  -0.5968   1.9927  26.0705 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##         Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## crim     -1.0059     0.5000  -2.012 0.045575 *  </span></span>
<span><span class="co">## zn        0.8264     0.4991   1.656 0.099298 .  </span></span>
<span><span class="co">## indus     0.1430     0.7574   0.189 0.850401    </span></span>
<span><span class="co">## chas      0.6056     0.3571   1.696 0.091434 .  </span></span>
<span><span class="co">## nox      -1.8962     0.6871  -2.760 0.006311 ** </span></span>
<span><span class="co">## rm        2.7488     0.4796   5.731 3.56e-08 ***</span></span>
<span><span class="co">## age       0.7043     0.6016   1.171 0.243052    </span></span>
<span><span class="co">## dis      -2.1701     0.6775  -3.203 0.001579 ** </span></span>
<span><span class="co">## rad       1.9496     0.9275   2.102 0.036785 *  </span></span>
<span><span class="co">## tax      -1.3630     1.0753  -1.268 0.206424    </span></span>
<span><span class="co">## ptratio  -1.7350     0.4696  -3.694 0.000283 ***</span></span>
<span><span class="co">## black     0.7928     0.4409   1.798 0.073660 .  </span></span>
<span><span class="co">## lstat    -3.9392     0.5793  -6.800 1.15e-10 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 5.065 on 203 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.6897, Adjusted R-squared:  0.6698 </span></span>
<span><span class="co">## F-statistic: 34.71 on 13 and 203 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">ridge_model</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               2.5 %      97.5 %</span></span>
<span><span class="co">## crim    -1.99177817 -0.01998703</span></span>
<span><span class="co">## zn      -0.15763891  1.81035788</span></span>
<span><span class="co">## indus   -1.35036253  1.63643261</span></span>
<span><span class="co">## chas    -0.09847995  1.30961784</span></span>
<span><span class="co">## nox     -3.25090385 -0.54151835</span></span>
<span><span class="co">## rm       1.80318002  3.69448343</span></span>
<span><span class="co">## age     -0.48180987  1.89044500</span></span>
<span><span class="co">## dis     -3.50598666 -0.83426263</span></span>
<span><span class="co">## rad      0.12085104  3.77840523</span></span>
<span><span class="co">## tax     -3.48320226  0.75724684</span></span>
<span><span class="co">## ptratio -2.66095278 -0.80898637</span></span>
<span><span class="co">## black   -0.07659270  1.66224338</span></span>
<span><span class="co">## lstat   -5.08143525 -2.79693765</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#print(simulate(ridge_model, newdata = test_data))</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="make-predictions-and-compare">Make predictions and compare<a class="anchor" aria-label="anchor" href="#make-predictions-and-compare"></a>
</h3>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">lm_model</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span>
<span><span class="va">ridge_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ridge_model</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Actual <span class="op">=</span> <span class="va">Boston</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">medv</span>,</span>
<span>  LM_Pred <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,</span>
<span>  LM_Lower <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>,</span>
<span>  LM_Upper <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span>,</span>
<span>  Ridge_Pred <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,</span>
<span>  Ridge_Lower <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>, </span>
<span>  Ridge_Upper <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Prediction Intervals Comparison:"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Prediction Intervals Comparison:"</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Actual  LM_Pred  LM_Lower LM_Upper Ridge_Pred Ridge_Lower Ridge_Upper</span></span>
<span><span class="co">## 1    24.0 30.57209 20.958399 40.18579   29.44374   20.432895    38.62332</span></span>
<span><span class="co">## 3    34.7 30.68339 21.107377 40.25940   30.84550   20.892099    38.71279</span></span>
<span><span class="co">## 4    33.4 28.70511 19.107688 38.30253   28.97805   20.359013    37.89275</span></span>
<span><span class="co">## 18   17.5 17.06191  7.487523 26.63630   17.65891    9.754859    27.10033</span></span>
<span><span class="co">## 21   13.6 12.85420  3.239688 22.46872   13.53186    4.287351    22.56573</span></span>
<span><span class="co">## 24   14.5 14.14956  4.535627 23.76348   15.32131    6.096803    24.66801</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate coverage and Winkler scores</span></span>
<span><span class="va">lm_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">medv</span> <span class="op">&gt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span> <span class="op">&amp;</span> </span>
<span>                   <span class="va">Boston</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">medv</span> <span class="op">&lt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">)</span></span>
<span><span class="va">ridge_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">medv</span> <span class="op">&gt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span> <span class="op">&amp;</span> </span>
<span>                      <span class="va">Boston</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">medv</span> <span class="op">&lt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_winkler</span> <span class="op">&lt;-</span> <span class="fu">misc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/misc/man/winkler_score.html" class="external-link">winkler_score</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">medv</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">)</span></span>
<span><span class="va">ridge_winkler</span> <span class="op">&lt;-</span> <span class="fu">misc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/misc/man/winkler_score.html" class="external-link">winkler_score</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">medv</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nPrediction interval metrics:"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "\nPrediction interval metrics:"</span></span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Linear Model: %.1f%% coverage, %.3f Winkler score"</span>, </span>
<span>              <span class="fl">100</span> <span class="op">*</span> <span class="va">lm_coverage</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lm_winkler</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Linear Model: 95.1% coverage, 26.711 Winkler score"</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Calibrated Model: %.1f%% coverage, %.3f Winkler score"</span>, </span>
<span>              <span class="fl">100</span> <span class="op">*</span> <span class="va">ridge_coverage</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ridge_winkler</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Calibrated Model: 94.1% coverage, 29.029 Winkler score"</span></span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualization</span></span>
<span><span class="co"># Set common y-axis limits for both plots</span></span>
<span><span class="va">y_limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span>,</span>
<span>                   <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Linear Model Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Pred</span>, </span>
<span>     main<span class="op">=</span><span class="st">"Linear Model Predictions"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Actual Median Value"</span>, ylab<span class="op">=</span><span class="st">"Predicted Median Value"</span>,</span>
<span>     ylim<span class="op">=</span><span class="va">y_limits</span><span class="op">)</span></span>
<span><span class="va">x_ordered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Pred</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ridge Model Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Pred</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Ridge Model Predictions"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Actual Median Value"</span>, ylab<span class="op">=</span><span class="st">"Predicted Median Value"</span>,</span>
<span>     ylim<span class="op">=</span><span class="va">y_limits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Pred</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ridgemodel_files/figure-html/unnamed-chunk-9-1.png" width="720"></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add simulation plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">ridge_model</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>, nsim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">sims</span>, type <span class="op">=</span> <span class="st">"l"</span>, </span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"obs. #"</span>, ylab <span class="op">=</span> <span class="st">"Simulated Median Value"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Ridge Model Simulations"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">medv</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ridgemodel_files/figure-html/unnamed-chunk-9-2.png" width="720"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-3-economic-indicators-longley-dataset">Example 3: Economic Indicators (Longley dataset)<a class="anchor" aria-label="anchor" href="#example-3-economic-indicators-longley-dataset"></a>
</h2>
<div class="section level3">
<h3 id="load-and-prepare-data-2">Load and prepare data<a class="anchor" aria-label="anchor" href="#load-and-prepare-data-2"></a>
</h3>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">longley</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1243</span><span class="op">)</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">longley</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">0.8</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">longley</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">longley</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">longley</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">-</span><span class="fl">7</span><span class="op">]</span>  <span class="co"># -7 removes 'Employed' (target variable)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-models-2">Fit models<a class="anchor" aria-label="anchor" href="#fit-models-2"></a>
</h3>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit regular linear model</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">lm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Employed</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">##   0.008</span></span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Employed ~ ., data = train_data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     1948     1951     1962     1960     1953     1958     1956     1947 </span></span>
<span><span class="co">## -0.15209  0.23935 -0.15902 -0.15702  0.04017 -0.11637  0.35418  0.07762 </span></span>
<span><span class="co">##     1954     1955     1952     1961 </span></span>
<span><span class="co">## -0.03138 -0.23164 -0.18207  0.31828 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                Estimate Std. Error t value Pr(&gt;|t|)   </span></span>
<span><span class="co">## (Intercept)  -3.314e+03  9.930e+02  -3.338  0.02061 * </span></span>
<span><span class="co">## GNP.deflator -7.877e-02  1.033e-01  -0.763  0.48016   </span></span>
<span><span class="co">## GNP          -6.186e-03  4.032e-02  -0.153  0.88407   </span></span>
<span><span class="co">## Unemployed   -1.578e-02  6.060e-03  -2.604  0.04802 * </span></span>
<span><span class="co">## Armed.Forces -1.074e-02  2.478e-03  -4.336  0.00745 **</span></span>
<span><span class="co">## Population   -3.256e-01  2.798e-01  -1.164  0.29697   </span></span>
<span><span class="co">## Year          1.758e+00  5.066e-01   3.470  0.01784 * </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.3053 on 5 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.9962, Adjusted R-squared:  0.9916 </span></span>
<span><span class="co">## F-statistic: 216.2 on 6 and 5 DF,  p-value: 7.153e-06</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                      2.5 %        97.5 %</span></span>
<span><span class="co">## (Intercept)  -5.866601e+03 -7.615995e+02</span></span>
<span><span class="co">## GNP.deflator -3.443182e-01  1.867776e-01</span></span>
<span><span class="co">## GNP          -1.098296e-01  9.745798e-02</span></span>
<span><span class="co">## Unemployed   -3.135588e-02 -2.021522e-04</span></span>
<span><span class="co">## Armed.Forces -1.711223e-02 -4.374897e-03</span></span>
<span><span class="co">## Population   -1.044745e+00  3.935168e-01</span></span>
<span><span class="co">## Year          4.557539e-01  3.060217e+00</span></span></code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit calibrated model </span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">ridge_model</span> <span class="op">&lt;-</span> <span class="fu">rvfl</span><span class="fu">::</span><span class="fu">calibmodel</span><span class="op">(</span>lambda<span class="op">=</span><span class="fl">10</span><span class="op">**</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">train_data</span><span class="op">$</span><span class="va">Employed</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">##   0.014</span></span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ridge_model</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## engine(formula = y ~ . - 1, data = df_train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -0.46493 -0.07890  0.03725  0.08371  0.52111 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)   </span></span>
<span><span class="co">## GNP.deflator  -1.2793     0.9873  -1.296  0.23118   </span></span>
<span><span class="co">## GNP            0.3637     2.9849   0.122  0.90603   </span></span>
<span><span class="co">## Unemployed    -1.5944     0.6028  -2.645  0.02949 * </span></span>
<span><span class="co">## Armed.Forces  -0.6449     0.1501  -4.297  0.00263 **</span></span>
<span><span class="co">## Population    -1.0203     2.2167  -0.460  0.65758   </span></span>
<span><span class="co">## Year           6.7454     2.0487   3.292  0.01098 * </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.2715 on 8 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.9934, Adjusted R-squared:  0.9885 </span></span>
<span><span class="co">## F-statistic: 201.8 on 6 and 8 DF,  p-value: 2.755e-08</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">ridge_model</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   2.5 %     97.5 %</span></span>
<span><span class="co">## GNP.deflator -3.5559317  0.9973284</span></span>
<span><span class="co">## GNP          -6.5194414  7.2468205</span></span>
<span><span class="co">## Unemployed   -2.9845200 -0.2042948</span></span>
<span><span class="co">## Armed.Forces -0.9909028 -0.2988122</span></span>
<span><span class="co">## Population   -6.1320605  4.0915301</span></span>
<span><span class="co">## Year          2.0209849 11.4697499</span></span></code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#print(simulate(ridge_model, newdata = test_data))</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="make-predictions-and-compare-1">Make predictions and compare<a class="anchor" aria-label="anchor" href="#make-predictions-and-compare-1"></a>
</h3>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">lm_model</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span>
<span><span class="va">ridge_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ridge_model</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Actual <span class="op">=</span> <span class="va">longley</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">Employed</span>,</span>
<span>  LM_Pred <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,</span>
<span>  LM_Lower <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>,</span>
<span>  LM_Upper <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span>,</span>
<span>  Ridge_Pred <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,</span>
<span>  Ridge_Lower <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>, </span>
<span>  Ridge_Upper <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Prediction Intervals Comparison:"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Prediction Intervals Comparison:"</span></span></code></pre>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Actual  LM_Pred LM_Lower LM_Upper Ridge_Pred Ridge_Lower Ridge_Upper</span></span>
<span><span class="co">## 1949 60.171 60.37956 59.30054 61.45858   60.20486    59.71372    60.81235</span></span>
<span><span class="co">## 1950 61.187 61.98029 60.88386 63.07672   61.80866    61.31424    62.39297</span></span>
<span><span class="co">## 1957 68.169 68.14194 67.12972 69.15416   68.02574    67.41703    68.56437</span></span>
<span><span class="co">## 1959 68.655 69.00940 67.99241 70.02638   68.86590    68.30258    69.46708</span></span></code></pre>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate coverage and Winkler scores</span></span>
<span><span class="va">lm_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">longley</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">Employed</span> <span class="op">&gt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span> <span class="op">&amp;</span> </span>
<span>                   <span class="va">longley</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">Employed</span> <span class="op">&lt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">)</span></span>
<span><span class="va">ridge_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">longley</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">Employed</span> <span class="op">&gt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span> <span class="op">&amp;</span> </span>
<span>                      <span class="va">longley</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">Employed</span> <span class="op">&lt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_winkler</span> <span class="op">&lt;-</span> <span class="fu">misc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/misc/man/winkler_score.html" class="external-link">winkler_score</a></span><span class="op">(</span><span class="va">longley</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">Employed</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">)</span></span>
<span><span class="va">ridge_winkler</span> <span class="op">&lt;-</span> <span class="fu">misc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/misc/man/winkler_score.html" class="external-link">winkler_score</a></span><span class="op">(</span><span class="va">longley</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">Employed</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nPrediction interval metrics:"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "\nPrediction interval metrics:"</span></span></code></pre>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Linear Model: %.1f%% coverage, %.3f Winkler score"</span>, </span>
<span>              <span class="fl">100</span> <span class="op">*</span> <span class="va">lm_coverage</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lm_winkler</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Linear Model: 100.0% coverage, 2.102 Winkler score"</span></span></code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Calibrated Model: %.1f%% coverage, %.3f Winkler score"</span>, </span>
<span>              <span class="fl">100</span> <span class="op">*</span> <span class="va">ridge_coverage</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ridge_winkler</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Calibrated Model: 75.0% coverage, 2.395 Winkler score"</span></span></code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualization</span></span>
<span><span class="co"># Set common y-axis limits for both plots</span></span>
<span><span class="va">y_limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span>,</span>
<span>                   <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Linear Model Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Pred</span>, </span>
<span>     main<span class="op">=</span><span class="st">"Linear Model Predictions"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Actual Employment"</span>, ylab<span class="op">=</span><span class="st">"Predicted Employment"</span>,</span>
<span>     ylim<span class="op">=</span><span class="va">y_limits</span><span class="op">)</span></span>
<span><span class="va">x_ordered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Pred</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ridge Model Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Pred</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Ridge Model Predictions"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Actual Employment"</span>, ylab<span class="op">=</span><span class="st">"Predicted Employment"</span>,</span>
<span>     ylim<span class="op">=</span><span class="va">y_limits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Pred</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ridgemodel_files/figure-html/unnamed-chunk-12-1.png" width="720"></p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add simulation plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">ridge_model</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>, nsim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">sims</span>, type <span class="op">=</span> <span class="st">"l"</span>, </span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"obs. #"</span>, ylab <span class="op">=</span> <span class="st">"Simulated Employment"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Ridge Model Simulations"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">longley</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">Employed</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ridgemodel_files/figure-html/unnamed-chunk-12-2.png" width="720"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-4-us-crime-rate-analysis">Example 4: US Crime Rate Analysis<a class="anchor" aria-label="anchor" href="#example-4-us-crime-rate-analysis"></a>
</h2>
<div class="section level3">
<h3 id="load-and-prepare-data-3">Load and prepare data<a class="anchor" aria-label="anchor" href="#load-and-prepare-data-3"></a>
</h3>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">UScrime</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1243</span><span class="op">)</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">UScrime</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">0.8</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">UScrime</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">UScrime</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">UScrime</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">-</span><span class="fl">16</span><span class="op">]</span>  <span class="co"># -16 removes 'y' (crime rate)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-models-3">Fit models<a class="anchor" aria-label="anchor" href="#fit-models-3"></a>
</h3>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit regular linear model</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">lm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">##   0.027</span></span></code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = y ~ ., data = train_data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -391.18 -114.34  -14.92  117.15  460.03 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##               Estimate Std. Error t value Pr(&gt;|t|)   </span></span>
<span><span class="co">## (Intercept) -6991.5860  2219.2203  -3.150  0.00483 **</span></span>
<span><span class="co">## M               7.1029     5.4076   1.313  0.20319   </span></span>
<span><span class="co">## So            -89.2556   183.9512  -0.485  0.63255   </span></span>
<span><span class="co">## Ed             22.1862     7.7816   2.851  0.00956 **</span></span>
<span><span class="co">## Po1            19.4504    15.2637   1.274  0.21648   </span></span>
<span><span class="co">## Po2           -10.7837    16.0263  -0.673  0.50837   </span></span>
<span><span class="co">## LF             -1.3616     1.8522  -0.735  0.47038   </span></span>
<span><span class="co">## M.F             2.9017     2.6491   1.095  0.28576   </span></span>
<span><span class="co">## Pop            -0.9371     1.6448  -0.570  0.57492   </span></span>
<span><span class="co">## NW              0.8155     0.9873   0.826  0.41810   </span></span>
<span><span class="co">## U1             -8.4003     5.8482  -1.436  0.16562   </span></span>
<span><span class="co">## U2             19.8835    11.0640   1.797  0.08671 . </span></span>
<span><span class="co">## GDP             0.7120     1.2620   0.564  0.57861   </span></span>
<span><span class="co">## Ineq            8.0589     2.8019   2.876  0.00904 **</span></span>
<span><span class="co">## Prob        -3533.2550  2862.6770  -1.234  0.23074   </span></span>
<span><span class="co">## Time            1.3920     9.4699   0.147  0.88454   </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 234.8 on 21 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.758,  Adjusted R-squared:  0.5851 </span></span>
<span><span class="co">## F-statistic: 4.385 on 15 and 21 DF,  p-value: 0.001081</span></span></code></pre>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     2.5 %       97.5 %</span></span>
<span><span class="co">## (Intercept) -11606.707241 -2376.464825</span></span>
<span><span class="co">## M               -4.142866    18.348646</span></span>
<span><span class="co">## So            -471.803028   293.291831</span></span>
<span><span class="co">## Ed               6.003559    38.368826</span></span>
<span><span class="co">## Po1            -12.292291    51.193066</span></span>
<span><span class="co">## Po2            -44.112293    22.544935</span></span>
<span><span class="co">## LF              -5.213545     2.490260</span></span>
<span><span class="co">## M.F             -2.607377     8.410782</span></span>
<span><span class="co">## Pop             -4.357700     2.483540</span></span>
<span><span class="co">## NW              -1.237650     2.868551</span></span>
<span><span class="co">## U1             -20.562297     3.761712</span></span>
<span><span class="co">## U2              -3.125406    42.892337</span></span>
<span><span class="co">## GDP             -1.912548     3.336557</span></span>
<span><span class="co">## Ineq             2.232069    13.885810</span></span>
<span><span class="co">## Prob         -9486.517778  2420.007809</span></span>
<span><span class="co">## Time           -18.301822    21.085767</span></span></code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit calibrated model </span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">ridge_model</span> <span class="op">&lt;-</span> <span class="fu">rvfl</span><span class="fu">::</span><span class="fu">calibmodel</span><span class="op">(</span>lambda<span class="op">=</span><span class="fl">10</span><span class="op">**</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">16</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">train_data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">##   0.046</span></span></code></pre>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ridge_model</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## engine(formula = y ~ . - 1, data = df_train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -362.44 -182.76  -80.78   49.85  441.14 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##      Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">## M      80.823     73.867   1.094    0.287</span></span>
<span><span class="co">## So    -44.123     88.038  -0.501    0.622</span></span>
<span><span class="co">## Ed      8.284     82.799   0.100    0.921</span></span>
<span><span class="co">## Po1    86.606     89.029   0.973    0.342</span></span>
<span><span class="co">## Po2    90.128     88.143   1.023    0.319</span></span>
<span><span class="co">## LF     29.463     79.163   0.372    0.714</span></span>
<span><span class="co">## M.F    52.984     65.431   0.810    0.428</span></span>
<span><span class="co">## Pop   -42.968     79.616  -0.540    0.595</span></span>
<span><span class="co">## NW     97.504     86.985   1.121    0.276</span></span>
<span><span class="co">## U1     -8.699     72.594  -0.120    0.906</span></span>
<span><span class="co">## U2     26.426     75.343   0.351    0.729</span></span>
<span><span class="co">## GDP    67.582     86.059   0.785    0.441</span></span>
<span><span class="co">## Ineq   81.123     82.098   0.988    0.335</span></span>
<span><span class="co">## Prob  -66.384     64.063  -1.036    0.312</span></span>
<span><span class="co">## Time   41.257     63.728   0.647    0.525</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 245 on 20 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.4321, Adjusted R-squared:  0.006091 </span></span>
<span><span class="co">## F-statistic: 1.014 on 15 and 20 DF,  p-value: 0.4792</span></span></code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">ridge_model</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           2.5 %    97.5 %</span></span>
<span><span class="co">## M     -73.26076 234.90732</span></span>
<span><span class="co">## So   -227.76670 139.52060</span></span>
<span><span class="co">## Ed   -164.43200 181.00010</span></span>
<span><span class="co">## Po1   -99.10457 272.31673</span></span>
<span><span class="co">## Po2   -93.73616 273.99198</span></span>
<span><span class="co">## LF   -135.66859 194.59472</span></span>
<span><span class="co">## M.F   -83.50344 189.47140</span></span>
<span><span class="co">## Pop  -209.04385 123.10699</span></span>
<span><span class="co">## NW    -83.94401 278.95125</span></span>
<span><span class="co">## U1   -160.12813 142.72969</span></span>
<span><span class="co">## U2   -130.73764 183.58975</span></span>
<span><span class="co">## GDP  -111.93316 247.09792</span></span>
<span><span class="co">## Ineq  -90.12969 252.37578</span></span>
<span><span class="co">## Prob -200.01696  67.24872</span></span>
<span><span class="co">## Time  -91.67745 174.19172</span></span></code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#print(simulate(ridge_model, newdata = test_data))</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="make-predictions-and-compare-2">Make predictions and compare<a class="anchor" aria-label="anchor" href="#make-predictions-and-compare-2"></a>
</h3>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">lm_model</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span>
<span><span class="va">ridge_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ridge_model</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Actual <span class="op">=</span> <span class="va">UScrime</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">y</span>,</span>
<span>  LM_Pred <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,</span>
<span>  LM_Lower <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>,</span>
<span>  LM_Upper <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span>,</span>
<span>  Ridge_Pred <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,</span>
<span>  Ridge_Lower <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>, </span>
<span>  Ridge_Upper <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Prediction Intervals Comparison:"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Prediction Intervals Comparison:"</span></span></code></pre>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Actual   LM_Pred   LM_Lower  LM_Upper Ridge_Pred Ridge_Lower Ridge_Upper</span></span>
<span><span class="co">## 12    849  719.5590  182.69137 1256.4267   893.7853   348.01721    1452.319</span></span>
<span><span class="co">## 15    798  921.6767  235.20569 1608.1477   689.3738   213.98321    1246.510</span></span>
<span><span class="co">## 17    539  348.0668 -234.64451  930.7781   555.1156    84.31633    1041.709</span></span>
<span><span class="co">## 22    439  893.1083  134.81936 1651.3973   912.4104   502.62349    1411.349</span></span>
<span><span class="co">## 24    968  818.2359  229.38384 1407.0880   886.8829   369.98278    1334.325</span></span>
<span><span class="co">## 25    523  647.7505   61.12691 1234.3740   653.4152    91.70916    1135.553</span></span>
<span><span class="co">## 26   1993 2048.5990 1242.60027 2854.5976  1611.7957  1126.34090    2143.271</span></span>
<span><span class="co">## 27    342  223.8301 -393.75690  841.4171   642.8889   159.65093    1100.579</span></span>
<span><span class="co">## 30    696  773.9915  175.98711 1371.9959   878.0996   346.22588    1369.786</span></span>
<span><span class="co">## 44   1030 1122.7567  539.93113 1705.5822  1127.1471   653.18937    1586.706</span></span></code></pre>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate coverage and Winkler scores</span></span>
<span><span class="va">lm_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">UScrime</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">y</span> <span class="op">&gt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span> <span class="op">&amp;</span> </span>
<span>                   <span class="va">UScrime</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">)</span></span>
<span><span class="va">ridge_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">UScrime</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">y</span> <span class="op">&gt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span> <span class="op">&amp;</span> </span>
<span>                      <span class="va">UScrime</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_winkler</span> <span class="op">&lt;-</span> <span class="fu">misc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/misc/man/winkler_score.html" class="external-link">winkler_score</a></span><span class="op">(</span><span class="va">UScrime</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">y</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">)</span></span>
<span><span class="va">ridge_winkler</span> <span class="op">&lt;-</span> <span class="fu">misc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/misc/man/winkler_score.html" class="external-link">winkler_score</a></span><span class="op">(</span><span class="va">UScrime</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">y</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nPrediction interval metrics:"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "\nPrediction interval metrics:"</span></span></code></pre>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Linear Model: %.1f%% coverage, %.3f Winkler score"</span>, </span>
<span>              <span class="fl">100</span> <span class="op">*</span> <span class="va">lm_coverage</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lm_winkler</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Linear Model: 100.0% coverage, 1268.846 Winkler score"</span></span></code></pre>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Calibrated Model: %.1f%% coverage, %.3f Winkler score"</span>, </span>
<span>              <span class="fl">100</span> <span class="op">*</span> <span class="va">ridge_coverage</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ridge_winkler</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Calibrated Model: 90.0% coverage, 1247.101 Winkler score"</span></span></code></pre>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualization</span></span>
<span><span class="co"># Set common y-axis limits for both plots</span></span>
<span><span class="va">y_limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span>,</span>
<span>                   <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Linear Model Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Pred</span>, </span>
<span>     main<span class="op">=</span><span class="st">"Linear Model Predictions"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Actual Crime Rate"</span>, ylab<span class="op">=</span><span class="st">"Predicted Crime Rate"</span>,</span>
<span>     ylim<span class="op">=</span><span class="va">y_limits</span><span class="op">)</span></span>
<span><span class="va">x_ordered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Pred</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ridge Model Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Pred</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Ridge Model Predictions"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Actual Crime Rate"</span>, ylab<span class="op">=</span><span class="st">"Predicted Crime Rate"</span>,</span>
<span>     ylim<span class="op">=</span><span class="va">y_limits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Pred</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ridgemodel_files/figure-html/unnamed-chunk-15-1.png" width="720"></p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add simulation plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">ridge_model</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>, nsim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">sims</span>, type <span class="op">=</span> <span class="st">"l"</span>, </span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"obs. #"</span>, ylab <span class="op">=</span> <span class="st">"Simulated Crime Rate"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Ridge Model Simulations"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">UScrime</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">$</span><span class="va">y</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ridgemodel_files/figure-html/unnamed-chunk-15-2.png" width="720"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-5-car-price-analysis-cars93-dataset">Example 5: Car Price Analysis (Cars93 dataset)<a class="anchor" aria-label="anchor" href="#example-5-car-price-analysis-cars93-dataset"></a>
</h2>
<div class="section level3">
<h3 id="load-and-prepare-data-4">Load and prepare data<a class="anchor" aria-label="anchor" href="#load-and-prepare-data-4"></a>
</h3>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Cars93</span>, package <span class="op">=</span> <span class="st">"MASS"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove rows with missing values</span></span>
<span><span class="va">Cars93</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">Cars93</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select numeric predictors and price as response</span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MPG.city"</span>, <span class="st">"MPG.highway"</span>, <span class="st">"EngineSize"</span>, <span class="st">"Horsepower"</span>, </span>
<span>                <span class="st">"RPM"</span>, <span class="st">"Rev.per.mile"</span>, <span class="st">"Fuel.tank.capacity"</span>, <span class="st">"Length"</span>, </span>
<span>                <span class="st">"Wheelbase"</span>, <span class="st">"Width"</span>, <span class="st">"Turn.circle"</span>, <span class="st">"Weight"</span><span class="op">)</span></span>
<span><span class="va">car_data</span> <span class="op">&lt;-</span> <span class="va">Cars93</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">predictors</span>, <span class="st">"Price"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1243</span><span class="op">)</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">car_data</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">0.8</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">car_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">car_data</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">car_data</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">car_data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Price"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-models-4">Fit models<a class="anchor" aria-label="anchor" href="#fit-models-4"></a>
</h3>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit regular linear model</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">lm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">##   0.023</span></span></code></pre>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Price ~ ., data = train_data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -8.9444 -3.4879 -0.0823  2.5740 10.7036 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                      Estimate Std. Error t value Pr(&gt;|t|)  </span></span>
<span><span class="co">## (Intercept)         6.0285088 31.8235292   0.189   0.8505  </span></span>
<span><span class="co">## MPG.city           -0.3069383  0.4798163  -0.640   0.5252  </span></span>
<span><span class="co">## MPG.highway        -0.0041568  0.4591254  -0.009   0.9928  </span></span>
<span><span class="co">## EngineSize          2.4810783  2.4779636   1.001   0.3213  </span></span>
<span><span class="co">## Horsepower          0.1016741  0.0446071   2.279   0.0268 *</span></span>
<span><span class="co">## RPM                 0.0001602  0.0023006   0.070   0.9448  </span></span>
<span><span class="co">## Rev.per.mile        0.0049762  0.0026868   1.852   0.0697 .</span></span>
<span><span class="co">## Fuel.tank.capacity -0.1866149  0.5198553  -0.359   0.7211  </span></span>
<span><span class="co">## Length              0.0203242  0.1333518   0.152   0.8795  </span></span>
<span><span class="co">## Wheelbase           0.4888949  0.2655782   1.841   0.0713 .</span></span>
<span><span class="co">## Width              -0.8957689  0.4446575  -2.015   0.0491 *</span></span>
<span><span class="co">## Turn.circle        -0.3835124  0.3579624  -1.071   0.2889  </span></span>
<span><span class="co">## Weight              0.0041302  0.0059593   0.693   0.4914  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 4.731 on 52 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.7886, Adjusted R-squared:  0.7398 </span></span>
<span><span class="co">## F-statistic: 16.16 on 12 and 52 DF,  p-value: 1.548e-13</span></span></code></pre>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                            2.5 %       97.5 %</span></span>
<span><span class="co">## (Intercept)        -5.783007e+01 69.887091986</span></span>
<span><span class="co">## MPG.city           -1.269760e+00  0.655883438</span></span>
<span><span class="co">## MPG.highway        -9.254594e-01  0.917145804</span></span>
<span><span class="co">## EngineSize         -2.491319e+00  7.453475962</span></span>
<span><span class="co">## Horsepower          1.216348e-02  0.191184768</span></span>
<span><span class="co">## RPM                -4.456410e-03  0.004776746</span></span>
<span><span class="co">## Rev.per.mile       -4.152533e-04  0.010367616</span></span>
<span><span class="co">## Fuel.tank.capacity -1.229781e+00  0.856550981</span></span>
<span><span class="co">## Length             -2.472657e-01  0.287914102</span></span>
<span><span class="co">## Wheelbase          -4.402679e-02  1.021816593</span></span>
<span><span class="co">## Width              -1.788039e+00 -0.003498354</span></span>
<span><span class="co">## Turn.circle        -1.101817e+00  0.334791684</span></span>
<span><span class="co">## Weight             -7.828121e-03  0.016088453</span></span></code></pre>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit calibrated model </span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">ridge_model</span> <span class="op">&lt;-</span> <span class="fu">rvfl</span><span class="fu">::</span><span class="fu">calibmodel</span><span class="op">(</span>lambda<span class="op">=</span><span class="fl">10</span><span class="op">**</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Price"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                               y <span class="op">=</span> <span class="va">train_data</span><span class="op">$</span><span class="va">Price</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">##   0.021</span></span></code></pre>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ridge_model</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## engine(formula = y ~ . - 1, data = df_train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -7.7848 -2.9438 -0.5461  1.0213 13.0730 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                    Estimate Std. Error t value Pr(&gt;|t|)  </span></span>
<span><span class="co">## MPG.city           -0.90230    1.49983  -0.602   0.5516  </span></span>
<span><span class="co">## MPG.highway        -0.33641    1.39992  -0.240   0.8116  </span></span>
<span><span class="co">## EngineSize          2.56961    1.62400   1.582   0.1231  </span></span>
<span><span class="co">## Horsepower          2.43635    1.35158   1.803   0.0806 .</span></span>
<span><span class="co">## RPM                 0.90504    1.05839   0.855   0.3987  </span></span>
<span><span class="co">## Rev.per.mile        1.30430    1.26257   1.033   0.3091  </span></span>
<span><span class="co">## Fuel.tank.capacity  0.24579    1.53119   0.161   0.8734  </span></span>
<span><span class="co">## Length              0.48894    1.63807   0.298   0.7672  </span></span>
<span><span class="co">## Wheelbase           1.73442    1.50930   1.149   0.2588  </span></span>
<span><span class="co">## Width              -1.03940    1.50301  -0.692   0.4941  </span></span>
<span><span class="co">## Turn.circle        -0.04015    1.23036  -0.033   0.9742  </span></span>
<span><span class="co">## Weight              1.26377    1.72926   0.731   0.4701  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 4.635 on 33 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.7162, Adjusted R-squared:  0.613 </span></span>
<span><span class="co">## F-statistic: 6.941 on 12 and 33 DF,  p-value: 4.626e-06</span></span></code></pre>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">ridge_model</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                         2.5 %   97.5 %</span></span>
<span><span class="co">## MPG.city           -3.9537326 2.149140</span></span>
<span><span class="co">## MPG.highway        -3.1845672 2.511751</span></span>
<span><span class="co">## EngineSize         -0.7344545 5.873667</span></span>
<span><span class="co">## Horsepower         -0.3134638 5.186174</span></span>
<span><span class="co">## RPM                -1.2482730 3.058343</span></span>
<span><span class="co">## Rev.per.mile       -1.2644053 3.873015</span></span>
<span><span class="co">## Fuel.tank.capacity -2.8694490 3.361026</span></span>
<span><span class="co">## Length             -2.8437419 3.821621</span></span>
<span><span class="co">## Wheelbase          -1.3362713 4.805113</span></span>
<span><span class="co">## Width              -4.0972869 2.018491</span></span>
<span><span class="co">## Turn.circle        -2.5433350 2.463028</span></span>
<span><span class="co">## Weight             -2.2544441 4.781978</span></span></code></pre>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#print(simulate(ridge_model, newdata = as.matrix(test_data)))</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="make-predictions-and-compare-3">Make predictions and compare<a class="anchor" aria-label="anchor" href="#make-predictions-and-compare-3"></a>
</h3>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">lm_model</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span>
<span><span class="va">ridge_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ridge_model</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Actual <span class="op">=</span> <span class="va">car_data</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="st">"Price"</span><span class="op">]</span>,</span>
<span>  LM_Pred <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,</span>
<span>  LM_Lower <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>,</span>
<span>  LM_Upper <span class="op">=</span> <span class="va">lm_pred</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span>,</span>
<span>  Ridge_Pred <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"fit"</span><span class="op">]</span>,</span>
<span>  Ridge_Lower <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"lwr"</span><span class="op">]</span>, </span>
<span>  Ridge_Upper <span class="op">=</span> <span class="va">ridge_pred</span><span class="op">[</span>,<span class="st">"upr"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Prediction Intervals Comparison:"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Prediction Intervals Comparison:"</span></span></code></pre>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Actual   LM_Pred   LM_Lower LM_Upper Ridge_Pred Ridge_Lower Ridge_Upper</span></span>
<span><span class="co">## 7    20.8 22.284761 12.3951390 32.17438  23.917810  13.4779817    33.64091</span></span>
<span><span class="co">## 12   13.4 14.354853  3.3289673 25.38074  14.785361   3.6024949    23.16887</span></span>
<span><span class="co">## 15   15.9 17.852333  7.2347759 28.46989  19.449692   9.2716783    28.43535</span></span>
<span><span class="co">## 21   15.8 19.516709  9.4219263 29.61149  19.996143  10.7438145    30.25961</span></span>
<span><span class="co">## 23    9.2 14.340649  3.5068316 25.17447  14.165389   3.9670943    23.76032</span></span>
<span><span class="co">## 29   12.2  9.028432 -1.4360619 19.49293  11.070554   2.5323276    21.22703</span></span>
<span><span class="co">## 30   19.3 29.775630 19.1961282 40.35513  27.897380  17.8470710    40.10897</span></span>
<span><span class="co">## 31    7.4  6.013838 -5.5354656 17.56314   5.517598  -3.9056060    17.45895</span></span>
<span><span class="co">## 32   10.1 14.806645  4.1551453 25.45814  15.464229   5.5927639    26.44416</span></span>
<span><span class="co">## 42   12.1  8.704607 -3.6984146 21.10763   9.666462  -0.0936653    20.58358</span></span>
<span><span class="co">## 54   11.6 10.002970 -0.3839704 20.38991  12.338981   3.2954121    21.43936</span></span>
<span><span class="co">## 59   61.9 34.711053 24.1509123 45.27119  28.608455  18.2021706    38.94056</span></span>
<span><span class="co">## 72   14.4  9.110664 -1.1222765 19.34360  12.150602   2.1902366    21.30203</span></span>
<span><span class="co">## 73    9.0 11.005860  0.0448295 21.96689  11.427271   2.3554448    20.36018</span></span>
<span><span class="co">## 76   18.5 26.775186 16.6537717 36.89660  25.025773  14.6108309    35.67831</span></span>
<span><span class="co">## 91   23.3 24.122428 12.0542302 36.19063  22.137527  12.8617452    31.22791</span></span>
<span><span class="co">## 92   22.7 18.531114  8.4532906 28.60894  18.636834   8.0602047    28.21954</span></span></code></pre>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate coverage and Winkler scores</span></span>
<span><span class="va">lm_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">car_data</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="st">"Price"</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span> <span class="op">&amp;</span> </span>
<span>                   <span class="va">car_data</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="st">"Price"</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">)</span></span>
<span><span class="va">ridge_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">car_data</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="st">"Price"</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span> <span class="op">&amp;</span> </span>
<span>                      <span class="va">car_data</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="st">"Price"</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_winkler</span> <span class="op">&lt;-</span> <span class="fu">misc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/misc/man/winkler_score.html" class="external-link">winkler_score</a></span><span class="op">(</span><span class="va">car_data</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="st">"Price"</span><span class="op">]</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">)</span></span>
<span><span class="va">ridge_winkler</span> <span class="op">&lt;-</span> <span class="fu">misc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/misc/man/winkler_score.html" class="external-link">winkler_score</a></span><span class="op">(</span><span class="va">car_data</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="st">"Price"</span><span class="op">]</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nPrediction interval metrics:"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "\nPrediction interval metrics:"</span></span></code></pre>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Linear Model: %.1f%% coverage, %.3f Winkler score"</span>, </span>
<span>              <span class="fl">100</span> <span class="op">*</span> <span class="va">lm_coverage</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lm_winkler</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Linear Model: 94.1% coverage, 60.599 Winkler score"</span></span></code></pre>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Calibrated Model: %.1f%% coverage, %.3f Winkler score"</span>, </span>
<span>              <span class="fl">100</span> <span class="op">*</span> <span class="va">ridge_coverage</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ridge_winkler</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Calibrated Model: 94.1% coverage, 73.884 Winkler score"</span></span></code></pre>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualization</span></span>
<span><span class="co"># Set common y-axis limits for both plots</span></span>
<span><span class="va">y_limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span>,</span>
<span>                   <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Linear Model Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Pred</span>, </span>
<span>     main<span class="op">=</span><span class="st">"Linear Model Predictions"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Actual Price ($1000s)"</span>, ylab<span class="op">=</span><span class="st">"Predicted Price ($1000s)"</span>,</span>
<span>     ylim<span class="op">=</span><span class="va">y_limits</span><span class="op">)</span></span>
<span><span class="va">x_ordered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Lower</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">LM_Upper</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">LM_Pred</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ridge Model Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Pred</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Ridge Model Predictions"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Actual Price ($1000s)"</span>, ylab<span class="op">=</span><span class="st">"Predicted Price ($1000s)"</span>,</span>
<span>     ylim<span class="op">=</span><span class="va">y_limits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Ridge_Lower</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Ridge_Upper</span><span class="op">[</span><span class="va">x_ordered</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Actual</span>, <span class="va">results</span><span class="op">$</span><span class="va">Ridge_Pred</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ridgemodel_files/figure-html/unnamed-chunk-18-1.png" width="720"></p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add simulation plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">ridge_model</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>, nsim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">sims</span>, type <span class="op">=</span> <span class="st">"l"</span>, </span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"obs. #"</span>, ylab <span class="op">=</span> <span class="st">"Simulated Price ($1000s)"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Ridge Model Simulations"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">car_data</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="st">"Price"</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ridgemodel_files/figure-html/unnamed-chunk-18-2.png" width="720"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by T. Moudiki.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
